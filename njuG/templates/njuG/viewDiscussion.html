{% extends "base.html" %}
{% load staticfiles %}

{% block loadCss %}
<link rel="stylesheet" type="text/css" href="{% static "css/discussion.css" %}">
<link rel="stylesheet" type="text/css" href="{% static "css/viewDiscussion.css" %}">
{% endblock %}

{% block content %}
<div class="discussionPanel">
    <h2>{{ blog.title }}</h2>
    <div class="ui comments">
      <div class="comment">
        <a class="avatar">
          <img src="{% static "img/avatar/small/elliot.jpg" %}">
        </a>
        <div class="content">
          <a class="author">{{blog.user.username}}</a>
          <div class="text date" style="color: rgba(0,0,0,.4);">
            <span class="date">{{ blog.time }}</span>
          </div>
        </div>
      </div>
    </div>
    
    <p>
        {{ blog.content }}
    </p>
    
    <div class="ui comments">
      <h3 class="ui dividing header">评论</h3>
      {% for comment in blogComments %}
      <div class="comment">
          <a class="avatar">
              <img src="{% static "img/avatar/small/elliot.jpg" %}">
          </a>
          <div class="content">
              {% if comment.replyTo %}
              <a class="author">{{ comment.user.username }}</a>回复<a class="author">{{ comment.replyTo.user.username}}</a>
              {% else %}
              <a class="author">{{ comment.user.username}}</a>
              {% endif %}
              <div class="metadata">
                  <span class="date">{{ comment.time }}</span>
              </div>
              <div class="text">
                  {{comment.content}}
              </div>
              <div class="actions">
                  <a class="reply" commentid="{{ comment.id }}">Reply</a>
                  <form class="ui form" style="display: none">
                      <div class="field"><textarea rows="2" required></textarea></div>
                      <button class="ui labeled icon tiny basic button" type="submit">
                          <i class="send icon"></i>
                          回复
                      </button>
                  </form>
              </div>
          </div>
      </div>
      {% endfor %}

      <form class="ui reply form" id="blogCommentForm" blogid="{{blog.id}}">
        <div class="field">
          <textarea id="blogComment" name="blogComment"></textarea>
        </div>
        <button class="ui blue labeled submit icon button">
          <i class="icon edit"></i> Add Reply
        </button>
      </form>
    </div>
    
</div>


<script>
    $(document).ready(function(){
        $(".launch.item").removeClass("active");
        $(".launch.item").eq(1).addClass("active");
        
        $("#blogCommentForm").submit(function(){
            var blogid=$(this).attr("blogid");
            $(this).ajaxSubmit({
                dataType: "json",
                headers: { "X-CSRFToken": $.cookie("csrftoken") },
                type: 'POST',
                url: "/njuG/commentBlog/",
                data: {"content": $("#blogComment").val(), "blogid": blogid},
                success: function(response){
                    showMessage(1,"评论成功！");
                },
                complete: function(response){
                    $("#blogComment").val('');
                },
            });
            return false;
        });
        
        $("a.reply").click(function(){
            $(this).next().slideToggle("fast");
        });
    });
    
    $()
</script>
{% endblock %}
