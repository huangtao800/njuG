{% extends "njuG/home_base.html" %}

{% load staticfiles %}
{% load filters %}

{% block loadCss %}
<link rel="stylesheet" type="text/css" href="{% static "css/index.css" %}">
<link rel="stylesheet" type="text/css" href="{% static "css/home.css" %}">
<link rel="stylesheet" type="text/css" href="{% static "css/message.css" %}">
{% endblock %}

{% block tab_menu %}
<div class="ui vertical fluid tabular menu">
    {% if request.user.username == target.username %}
    <a href="{% url 'myHome' %}" class="item">
      我的发布
    </a>
    <a href="{% url 'message' %}" class="item active">
      我的消息
      {% if request.user.profile.unreadMessageCount > 0 %}
      <div class="ui teal pointing left label">{{request.user.profile.unreadMessageCount}}</div>
      {% endif %}
    </a>
    {% endif %}
    <a class="item">
      Companies
    </a>
    <a class="item">
      Links
    </a>
</div>
{% endblock %}

{% block tab_content %}

<div class="ui feed">
    {% for message in messages %}
    {% with source=message.source %}
    <div class="event">
        <div class="label">
            {% if source.profile.hasAvatar %}
            <img src="{% static message.source.username|getAvatarPath %}">
            {% else %}
            <img src="{% static ''|getAvatarPath %}">
            {% endif %}
        </div>
        <div class="content">
            <div class="summary">
                <a>{{ source.username }}</a> 在
                <span class="messageTopic">
                    {% if message|isPostComment or message|isReplyPostComment %}
                    {{ message.masterPost.content }}
                    {% elif message|isBlogComment or message|isReplyBlogComment %}
                    {{ message.masterBlog.title }}
                    {% endif %}
                </span> 中评论你：
                <div class="date">
                    {{ message.time }}
                </div>
            </div>
            <div class="extra text">
                {{ message.content }}
            </div>
            
            
            <div class="ui comments">
                <div class="comment">
                    <div class="actions">
                        <a class="reply postCommentReply">回复</a>
                        <a class="actions">已读</a>
                        {% if message|isPostComment or message|isReplyPostComment %} 
                        <form class="ui form postCommentReplyForm" style="display: none" 
                        commentid="{{ message.postComment.id}}", postid="{{ message.masterPost.id}}">
                        {% elif message|isBlogComment or message|isReplyBlogComment %}
                        <form class="ui form postCommentReplyForm" style="display: none" 
                        commentid="{{ message.blogComment.id}}", blogid="{{ message.masterBlog.id}}">
                        {% endif %}
                            <div class="field">
                                <textarea rows="2" name="content" required></textarea>
                            </div>
                            <button class="ui labeled icon tiny basic button" type="submit">
                                <i class="send icon"></i>
                                回复
                            </button>
                        </form>
                    </div>                
                </div>
            </div>

            
        </div>
    </div>
    {% endwith %}
    {% endfor %}
</div>

{% endblock %}

{% block loadJs %}
<script src="{% static "js/createEvent.js" %}"></script>
{% endblock%}
